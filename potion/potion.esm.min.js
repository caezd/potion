function t(e,n,o={}){if(this instanceof t)throw new Error("Don't call 'potion' with new");const r={start:"[",end:"]",path:"[a-z0-9_$][\\.a-z0-9_]*",...o},i={};let l={},s=!1;const c=new RegExp(`${u(r.start)}s*(!?)s*(${r.path})s*${u(r.end)}`,"gi");function f(t,e,n=0){if("string"!=typeof t||"function"!=typeof e)throw new TypeError("Invalid arguments: 'name' must be a string and 'fn' must be a function.");i[t]=i[t]||[],i[t].push([e,n]),i[t].sort(((t,e)=>t[1]-e[1]))}function a(t,e,...n){const o=i[t];if(!o)return e;for(const[t]of o){const o=t(e,...n);void 0!==e&&void 0!==o&&(e=o),null==o&&(e="")}return e}function u(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function p(t,e){if("string"==typeof t){if(void 0===e)return l[t]||"";!1===e?delete l[t]:l[t]=e}else"object"==typeof t&&null!==t?Object.keys(t).forEach((e=>{p(e,t[e])})):"boolean"!=typeof t||t||(l={});return l}function d(t,e){if(s||(s=!0,a("init")),!(t=a("templateBefore",t)).includes(r.start)){const e=p(t);e&&(t=e)}return(t=a("template",t))&&void 0!==e&&(t=function(t,e){let n;for(;null!==(n=c.exec(t));){const o=n[2];let i=a("token",o,e,t);const l=n.index,s=c.lastIndex,f=t.slice(0,l);let u=t.slice(s);if("function"==typeof i&&(i=i.call(e,e)),"boolean"!=typeof i&&"object"!=typeof i)t=f+i+u;else{let e="";const l=`${r.start}/${o}${r.end}`,s=u.indexOf(l);if(!(s>=0))throw new Error(`Potion: '${o}' not closed`);{const r=u.slice(0,s);if(u=u.slice(s+l.length),"boolean"==typeof i)console.log(i),e=i^"!"!==n[1]?"":r;else{for(const t in i)if(i.hasOwnProperty(t)){c.lastIndex=0;const n=a("loopData",{_key:t,_value:i[t],...i[t]},r,o);e+=a("loop",d(r,n),o,n)}e=a("loopEnd",e,o,i)}t=f+e+u}}c.lastIndex=0}return t}(t,e)),a("templateAfter",t)}return window&&window.document&&(t.renderFromDOM=function(t={}){const e=t.type||r.type||"template/potion",n=t.attr||r.attr||"data-name",o=document.querySelectorAll(`template[type='${e}']`),i={};return o.forEach(((t,e)=>{const o=t.getAttribute(n)||`potion-${e}`;i[o]=t.innerHTML})),p(i),i},f("init",(function(){t.renderFromDOM()}))),f("token",((t,e,n)=>{const o=t.split(".");let r=e;for(let t=0;t<o.length;t++){if(!Object.prototype.hasOwnProperty.call(r,o[t]))throw new Error(`Potion: '${o[t]}' not found${t?` in ${n}`:""}`);if(r=r[o[t]],t===o.length-1)return r}})),d(e,n)}export{t as default};
