var potion=function(){"use strict";function t(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return function(e,n,o={}){const r={start:"[",end:"]",path:"[a-z0-9_$][\\.a-z0-9_]*",...o},i={};let a={},c=!1;const l=new RegExp(`${t(r.start)}\\s*(!?)\\s*(${r.path})\\s*${t(r.end)}`,"gi");function s(t,e,...n){const o=i[t];if(!o)return e;for(const[t]of o){const o=t(e,...n);void 0!==e&&void 0!==o&&(e=o),null==o&&(e="")}return e}function f(t,e){let n;for(;null!==(n=l.exec(t));){const o=n[2];let i=s("token",o,e,t);const a=n.index,c=l.lastIndex,f=t.slice(0,a);let u=t.slice(c);if("function"==typeof i&&(i=i.call(e,e)),"boolean"!=typeof i&&"object"!=typeof i)t=f+i+u;else{let e="";const a=`${r.start}/${o}${r.end}`,c=u.indexOf(a);if(!(c>=0))throw new Error(`Potion: '${o}' not closed`);{const r=u.slice(0,c);if(u=u.slice(c+a.length),"boolean"==typeof i)e=i^"!"!==n[1]?"":r;else{for(const t in i)if(i.hasOwnProperty(t)){l.lastIndex=0;const n=s("loopData",{_key:t,_value:i[t],...i[t]},r,o);e+=s("loop",p(r,n),o,n)}e=s("loopEnd",e,o,i)}t=f+e+u}}l.lastIndex=0}return t}function u(t,e){if("string"==typeof t){if(void 0===e)return a[t]||"";!1===e?delete a[t]:a[t]=e}else"object"==typeof t&&null!==t?Object.keys(t).forEach((e=>{u(e,t[e])})):"boolean"!=typeof t||t||(a={});return a}function d(t,e){[...t.attributes].forEach((n=>{if(n.name.startsWith("@")){const o=n.name.slice(1);let r=n.value.trim();const i=r.match(/^([a-zA-Z_$][a-zA-Z0-9_$]*)\((.*)\)$/);let a,c=[];if(i?(a=i[1],c=i[2].split(",").map((t=>t.trim())).map((t=>"true"===t||"false"!==t&&(isNaN(t)?t.startsWith("'")&&t.endsWith("'")||t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1):e[t]||t:Number(t))))):a=r,"function"==typeof e[a]){t.removeEventListener(o,t._boundEvents?.[o]);const n=t=>{e[a].apply(e,[t,...c])};t.addEventListener(o,n),t._boundEvents=t._boundEvents||{},t._boundEvents[o]=n}else console.warn(`Potion: function '${a}' not found in data.`)}}))}function p(t,e){if(c||(c=!0,s("init")),!(t=s("templateBefore",t)).includes(r.start)){const e=u(t);e&&(t=e)}return(t=s("template",t))&&void 0!==e&&(t=f(t,e)),s("templateAfter",t)}function m(t,e,o={}){if(!(t instanceof HTMLTemplateElement))return void console.error("L'élément fourni n'est pas un `<template>`.");const r=o.tag||"div",i=document.createElement(r);return i.innerHTML=e,[...t.attributes].forEach((t=>{"type"!==t.name&&i.setAttribute(t.name,t.value)})),o.class&&i.classList.add(...o.class.split(" ")),[...i.querySelectorAll("*")].forEach((t=>d(t,n))),t.parentNode.replaceChild(i,t),i}if(function(t,e,n=0){if("function"!=typeof e)throw new TypeError("Invalid arguments: 'name' must be a string and 'fn' must be a function.");i[t]=i[t]||[],i[t].push([e,n]),i[t].sort(((t,e)=>t[1]-e[1]))}("token",((t,e,n)=>{const o=t.split(".");let r=e;for(let t=0;t<o.length;t++){if(!Object.prototype.hasOwnProperty.call(r,o[t]))throw new Error(`Potion: '${o[t]}' not found${t?` in ${n}`:""}`);if(r=r[o[t]],t===o.length-1)return r}})),window&&window.document){const h=r.type||"template/potion",y=r.attr||"data-name",E=document.querySelectorAll(`template[type='${h}']`);function w(t,e){const n=document.querySelector(`template[data-name='${t}']`);if(!n)throw new Error(`Potion: template with name '${t}' not found`);const o=a[t]||n.innerHTML,r={dom:n.parentNode,props:{children:[o]},alternate:null};function i(n){const o=document.createElement("div");return o.setAttribute("data-name",t),o.innerHTML=f(n.props.children[0],e),o}function c(){l(r.child)}function l(t){if(!t)return;const n=t.parent.dom;if("PLACEMENT"===t.effectTag&&null!=t.dom)n.appendChild(t.dom);else if("UPDATE"===t.effectTag&&null!=t.dom){const e=i(t);n.contains(t.dom)?n.replaceChild(e,t.dom):n.appendChild(e),t.dom=e}l(t.child),l(t.sibling),[...r.dom.querySelectorAll("*")].forEach((t=>d(t,e)))}function s(){r.child||(r.child={dom:i(r),parent:r,props:r.props,effectTag:"PLACEMENT"}),c()}const u={set:(t,e,n)=>("length"===e||t[e]===n||(t[e]=n,r.child.effectTag="UPDATE",s()),!0),get:(t,e)=>"function"==typeof t[e]?function(...n){const o=t[e].apply(t,n);return r.child.effectTag="UPDATE",s(),o}:t[e]},p=new Proxy(e,{set:function(t,e,n){return Array.isArray(n)&&(n=new Proxy(n,u)),t[e]=n,r.child.effectTag="UPDATE",s(),!0},get:(t,e)=>Array.isArray(t[e])?new Proxy(t[e],u):t[e]});return s(),p}p.renderFromDOM=function(){const t={};return E.forEach(((e,n)=>{const o=e.getAttribute(y)||`potion-${n}`;t[o]=e.innerHTML})),u(t),t},p.renderFromDOM(),p.render=function(t,e,n={}){const o=document.querySelector(`template[data-name='${t}']`);if(!o)throw new Error(`Potion: template with name '${t}' not found`);return m(o,p(t,e),n)},p.reactivity=w}return p}()}();
