var potion=function(){"use strict";function t(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}return function(e,n,o={}){const r={start:"[",end:"]",path:"[a-z0-9_$][\\.a-z0-9_]*",...o},i={};let l={},a=!1;const c=new RegExp(`${t(r.start)}\\s*(!?)\\s*(${r.path})\\s*${t(r.end)}`,"gi");function s(t,e,...n){const o=i[t];if(!o)return e;for(const[t]of o){const o=t(e,...n);void 0!==e&&void 0!==o&&(e=o),null==o&&(e="")}return e}function f(t,e){if("string"==typeof t){if(void 0===e)return l[t]||"";!1===e?delete l[t]:l[t]=e}else"object"==typeof t&&null!==t?Object.keys(t).forEach((e=>{f(e,t[e])})):"boolean"!=typeof t||t||(l={});return l}function u(t,e){if(a||(a=!0,s("init")),!(t=s("templateBefore",t)).includes(r.start)){const e=f(t);e&&(t=e)}return(t=s("template",t))&&void 0!==e&&(t=function(t,e){let n;for(;null!==(n=c.exec(t));){const o=n[2];let i=s("token",o,e,t);const l=n.index,a=c.lastIndex,f=t.slice(0,l);let u=t.slice(a);if("function"==typeof i&&(i=i.call(e,e)),"boolean"!=typeof i&&"object"!=typeof i)t=f+i+u;else{let e="";const l=`${r.start}/${o}${r.end}`,a=u.indexOf(l);if(!(a>=0))throw new Error(`Potion: '${o}' not closed`);{const r=u.slice(0,a);if(u=u.slice(a+l.length),"boolean"==typeof i)e=i^"!"!==n[1]?"":r;else{for(const t in i)if(i.hasOwnProperty(t)){c.lastIndex=0;const n=s("loopData",{_key:t,_value:i[t],...i[t]},r,o);e+=s("loop",create(r,n),o,n)}e=s("loopEnd",e,o,i)}t=f+e+u}}c.lastIndex=0}return t}(t,e)),s("templateAfter",t)}if(function(t,e,n=0){if("function"!=typeof e)throw new TypeError("Invalid arguments: 'name' must be a string and 'fn' must be a function.");i[t]=i[t]||[],i[t].push([e,n]),i[t].sort(((t,e)=>t[1]-e[1]))}("token",((t,e,n)=>{const o=t.split(".");let r=e;for(let t=0;t<o.length;t++){if(!Object.prototype.hasOwnProperty.call(r,o[t]))throw new Error(`Potion: '${o[t]}' not found${t?` in ${n}`:""}`);if(r=r[o[t]],t===o.length-1)return r}})),window&&window.document){const t=r.type||"template/potion",e=r.attr||"data-name",n=document.querySelectorAll(`template[type='${t}']`);u.renderFromDOM=function(){const t={};return n.forEach(((n,o)=>{const r=n.getAttribute(e)||`potion-${o}`;t[r]=n.innerHTML})),f(t),t},u.renderFromDOM(),u.render=function(t,e,n={}){const o=document.querySelector(`template[data-name='${t}']`);if(!o)throw new Error(`Potion: template with name '${t}' not found`);return function(t,e,n={}){if(!(t instanceof HTMLTemplateElement))return void console.error("L'élément fourni n'est pas un `<template>`.");const o=n.tag||"div",r=document.createElement(o);return r.innerHTML=e,[...t.attributes].forEach((t=>{"type"!==t.name&&r.setAttribute(t.name,t.value)})),n.class&&r.classList.add(...n.class.split(" ")),t.parentNode.replaceChild(r,t),r}(o,u(t,e),n)}}return u}()}();
