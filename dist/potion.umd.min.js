!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).poumon=e()}(this,(function(){"use strict";return class{#t=!1;#e=!1;static version(){return"1.0.0"}constructor(t,e,i={}){this.settings={start:"{{",end:"}}",path:"[a-z0-9_$][\\.a-z0-9_]*",...i},this.templates={},this.filers={},this.pattern=new RegExp(`${this.settings.start}s*(${this.settings.path})s*${this.settings.end}`,"gi"),this.create(t,e),this.init()}init(){this.addFilter("token",((t,e,i)=>{const s=t.split(".");let n=e;for(let t=0;t<s.length;t++){if(!Object.prototype.hasOwnProperty.call(n,s[t]))throw new Error(`Tim: '${s[t]}' not found${t?` in ${i}`:""}`);if(n=n[s[t]],t===s.length-1)return n}}))}create(t,e){if(this.initialized||(this.initialized=!0,this.applyFilter("init")),!(t=this.applyFilter("templateBefore",t)).includes(this.settings.start)){const e=this.templatesCache(t);e&&(t=e)}return(t=this.applyFilter("template",t))&&void 0!==e&&(t=this.substitute(t,e)),this.applyFilter("templateAfter",t)}templatesCache(t,e){if("string"==typeof t){if(void 0===e)return this.templates[t]||"";!1===e?delete this.templates[t]:this.templates[t]=e}else"object"==typeof t&&null!==t?Object.keys(t).forEach((e=>{this.templatesCache(e,t[e])})):"boolean"!=typeof t||t||(this.templates={});return this.templates}extend(t,e){return{...t,...e}}sortByPriority(t,e){return t[1]-e[1]}addFilter(t,e,i){if("string"!=typeof t||"function"!=typeof e)throw new TypeError("Invalid arguments: 'filterName' must be a string and 'fn' must be a function.");this.filters[t]=this.filters[t]||[];const s=filters[filterName];return s.push([e,i||0]),s.sort(this.sortByPriority),e}applyFilter(t,e,...i){const s=this.filters[t];if(!s)return e;for(let t=0;t<s.length;t++){const[n]=s[t],l=n(e,...i);if(void 0!==e&&void 0!==l&&(e=l),null==l&&(e=""),this.stopThisFilter){this.stopThisFilter=!1;break}}return e}filter(t,e){return("function"==typeof e?addFilter:applyFilder).apply(null,arguments)}stop(){this.stopThisFilter=!0}substitute(t,e){let i;for(;null!==(i=this.pattern.exec(t));){const s=i[1];let n=this.applyFilter("token",s,e,t);const l=i.index,r=this.pattern.lastIndex,o=this.template.slice(0,l);let a=this.template.slice(r);if("function"==typeof n&&(n=n.call(e)),"boolean"!=typeof n&&"object"!=typeof n)t=o+n+a;else{let e="";const i=`${this.settings.start}/${s}${this.settings.end}`,l=a.indexOf(i);if(!(l>=0))throw new Error(`Potion: '${s}' not closed`);{const r=a.slice(0,l);if(a=a.slice(l+i.length),"boolean"==typeof n)e=n?r:"";else{for(const t in n)if(n.hasOwnProperty(t)){this.pattern.lastIndex=0;const i=this.applyFilter("loopData",extend({_key:t,_value:n[t]},n[t]),r,s),l=this.create(r,i);e+=this.applyFilter("loop",l,s,i)}e=this.applyFilter("loopEnd",e,s,n)}t=o+e+a}}this.pattern.lastIndex=0}return t}}}));
