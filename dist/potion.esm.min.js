class t{#t=!1;#e=!1;static version(){return"1.0.0"}constructor(t,e,i={}){this.settings={start:"{{",end:"}}",path:"[a-z0-9_$][\\.a-z0-9_]*",...i},this.templates={},this.filers={},this.pattern=new RegExp(`${this.settings.start}s*(${this.settings.path})s*${this.settings.end}`,"gi"),this.create(t,e),this.init()}init(){this.addFilter("token",((t,e,i)=>{const s=t.split(".");let r=e;for(let t=0;t<s.length;t++){if(!Object.prototype.hasOwnProperty.call(r,s[t]))throw new Error(`Tim: '${s[t]}' not found${t?` in ${i}`:""}`);if(r=r[s[t]],t===s.length-1)return r}}))}create(t,e){if(this.initialized||(this.initialized=!0,this.applyFilter("init")),!(t=this.applyFilter("templateBefore",t)).includes(this.settings.start)){const e=this.templatesCache(t);e&&(t=e)}return(t=this.applyFilter("template",t))&&void 0!==e&&(t=this.substitute(t,e)),this.applyFilter("templateAfter",t)}templatesCache(t,e){if("string"==typeof t){if(void 0===e)return this.templates[t]||"";!1===e?delete this.templates[t]:this.templates[t]=e}else"object"==typeof t&&null!==t?Object.keys(t).forEach((e=>{this.templatesCache(e,t[e])})):"boolean"!=typeof t||t||(this.templates={});return this.templates}extend(t,e){return{...t,...e}}sortByPriority(t,e){return t[1]-e[1]}addFilter(t,e,i){if("string"!=typeof t||"function"!=typeof e)throw new TypeError("Invalid arguments: 'filterName' must be a string and 'fn' must be a function.");this.filters[t]=this.filters[t]||[];const s=filters[filterName];return s.push([e,i||0]),s.sort(this.sortByPriority),e}applyFilter(t,e,...i){const s=this.filters[t];if(!s)return e;for(let t=0;t<s.length;t++){const[r]=s[t],l=r(e,...i);if(void 0!==e&&void 0!==l&&(e=l),null==l&&(e=""),this.stopThisFilter){this.stopThisFilter=!1;break}}return e}filter(t,e){return("function"==typeof e?addFilter:applyFilder).apply(null,arguments)}stop(){this.stopThisFilter=!0}substitute(t,e){let i;for(;null!==(i=this.pattern.exec(t));){const s=i[1];let r=this.applyFilter("token",s,e,t);const l=i.index,n=this.pattern.lastIndex,o=this.template.slice(0,l);let a=this.template.slice(n);if("function"==typeof r&&(r=r.call(e)),"boolean"!=typeof r&&"object"!=typeof r)t=o+r+a;else{let e="";const i=`${this.settings.start}/${s}${this.settings.end}`,l=a.indexOf(i);if(!(l>=0))throw new Error(`Potion: '${s}' not closed`);{const n=a.slice(0,l);if(a=a.slice(l+i.length),"boolean"==typeof r)e=r?n:"";else{for(const t in r)if(r.hasOwnProperty(t)){this.pattern.lastIndex=0;const i=this.applyFilter("loopData",extend({_key:t,_value:r[t]},r[t]),n,s),l=this.create(n,i);e+=this.applyFilter("loop",l,s,i)}e=this.applyFilter("loopEnd",e,s,r)}t=o+e+a}}this.pattern.lastIndex=0}return t}}export{t as default};
